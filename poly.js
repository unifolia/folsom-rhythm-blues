(()=>{var F=(e,n)=>()=>(e&&(n=e(e=0)),n);var Y=(e,n)=>()=>(n||e((n={exports:{}}).exports,n),n.exports);var M=(e,n,a)=>new Promise((p,m)=>{var N=l=>{try{h(a.next(l))}catch(j){m(j)}},g=l=>{try{h(a.throw(l))}catch(j){m(j)}},h=l=>l.done?p(l.value):Promise.resolve(l.value).then(N,g);h((a=a.apply(e,n)).next())});var c,u,i,Z,_,L,G,pe,w,de,y,$,S,fe,be,q,B,ee,r,U=F(()=>{c=[1,5,8,13],u=[1,4,8,13],i=[1,1,5,8,11],Z=[1,1,6,8,11],_={e:4,f:5,gb:6,g:7,ab:8,a:9,bb:10,b:11,c:0,db:1,d:2,eb:3},{e:L,f:G,gb:pe,g:w,ab:de,a:y,bb:$,b:S,c:fe,db:be,d:q,eb:B}=_,ee={cmajor:c,cminor:u,c7:i,dmajor:c.map(e=>e+q),dminor:u.map(e=>e+q),d7:i.map(e=>e+q),ebmajor:c.map(e=>e+B),ebminor:u.map(e=>e+B),eb7:i.map(e=>e+B),emajor:c.map(e=>e+L),eminor:u.map(e=>e+L),e7:i.map(e=>e+L),fmajor:c.map(e=>e+G),fminor:u.map(e=>e+G),gmajor:c.map(e=>e+w),gminor:u.map(e=>e+w),g7:i.map(e=>e+w),amajor:c.map(e=>e+y),aminor:u.map(e=>e+y),a7:i.map(e=>e+y),asus4:Z.map(e=>e+y),bbmajor:c.map(e=>e+$),bmajor:c.map(e=>e+S),bminor:u.map(e=>e+S),b7:i.map(e=>e+S)},r=ee});var te,H,V=F(()=>{te=e=>{let a=Math.pow(2,.08333333333333333);return+(440*Math.pow(a,e+-22)).toFixed(4)},H=te});var ie=Y(P=>{U();V();var I=document.querySelector("input#polyOne"),E=document.querySelector("input#polyTwo"),x=document.querySelector("input#tempo"),T=document.querySelector("input#volume"),C=document.querySelector("#play"),ne=document.querySelector("#check"),s,o=[1],O=440,A=440,t=1,z=+T.value,D,J,K,b,d=.025,f=!1,oe=()=>M(P,null,function*(){s=new window.AudioContext}),Q=()=>{b=60/+x.value*4*1e3},k=()=>{O=H(o[Math.floor(Math.random()*o.length)]),A=H(o[Math.floor(Math.random()*o.length)])},re=()=>{t>12&&(t=1),(t===1||t===7||t===11)&&(o=r.emajor),t===5&&(o=r.amajor),t===9&&(o=r.b7),k()},ae=()=>{t>4&&(t=1),t===1&&(o=r.eminor),t===2&&(o=r.gmajor),t===3&&(o=r.dmajor),t===4&&(o=r.asus4),k()},me=()=>{t>4&&(t=1),t===1&&(o=r.ebmajor),t===2&&(o=r.fmajor),t===3&&(o=r.gmajor),k()},ce=()=>{let e=document.querySelector("input:checked");e!=null&&e.value&&(+e.value==1&&re(),+e.value==2&&ae(),+e.value==3&&me())},ue=(e,n)=>M(P,null,function*(){let a=s.createGain();a.gain.value=z/10,a.connect(s.destination);let p=s.createStereoPanner();p.pan.value=n==="left"?-.5:.5,p.connect(a);let m=s.createOscillator();m.type="square",m.frequency.setValueAtTime(e,s.currentTime),m.connect(p),m.start(),yield new Promise(g=>setTimeout(g,b*d)).then(()=>{m.stop(),m.disconnect()})}),v=(e,n)=>{ue(e,n)},R=()=>{K=setTimeout(()=>{W(),++t,f===!0?R():X()},b),ce(),v(O,"left"),v(A,"right"),D=setInterval(()=>{v(O,"left")},b/+I.value),J=setInterval(()=>{v(A,"right")},b/+E.value)},W=()=>{clearInterval(D),clearInterval(J),Q()},le=()=>{Q(),R(),C.innerText="Stop"},X=()=>{W(),clearInterval(K),t=1,C.innerText="Play"};C.addEventListener("click",()=>{s||oe(),f=!f,f?le():f||X()});ne.addEventListener("click",()=>{d===.025?d=d*30:d=.025});I.oninput=()=>{document.querySelector(".polyOne").innerHTML=I.value};E.oninput=()=>{document.querySelector(".polyTwo").innerHTML=E.value};x.oninput=()=>{document.querySelector(".tempo").innerHTML=x.value};T.oninput=()=>{document.querySelector(".volume").innerHTML=T.value,z=+T.value}});ie();})();
